{"version":3,"sources":["file:///E:/2.workspace/cocos%20creator/slot/SlotMachine/assets/scripts/ReelController.ts"],"names":["_decorator","Component","Prefab","ccclass","property","ReelController","type","_firstDelay","_count","_finished","_speed","_playing","onLoad","start","i","Math","random","a","floor","node","children","length","b","posA","position","posB","console","log","setPosition","setStartDelay","delay","setCount","count","onRunEvent","moveNextStatus","getPlaying","len","self","pos","cc","tween","to","v3","y","call","movingFinished","rollingFinished","anim","getComponent","Animation","play"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Prefab } from 'cc';\nconst { ccclass, property } = _decorator;\n\n@ccclass('ReelController')\nexport class ReelController extends Component {\n\n\n    @property({type: Prefab})\n    protected stops: Prefab[] = [];\n\n\n\n    private _firstDelay: number = 0;\n    private _count: number = 0;\n    private _finished: number = 0;\n    private _speed: number = 0.05;\n    private _playing: bool = false;\n\n    onLoad() {\n        \n\n    }\n\n    start() {\n        for (var i = 0; i < Math.random()*100; i ++) {\n\n            var a = Math.floor (Math.random()*100 % this.node.children.length);\n            var b = Math.floor (Math.random()*100 % this.node.children.length);\n\n            \n\n            var posA = this.node.children[a].position;\n            var posB = this.node.children[b].position;\n\n            console.log(a, b, posA, posB);\n\n            this.node.children[a].setPosition(posB);\n            this.node.children[b].setPosition(posA);\n        }\n    }\n\n    setStartDelay(delay) {\n        this._firstDelay = delay;\n    }\n\n    setCount(count) {\n        this._count = count;\n    }\n\n    onRunEvent() {\n    console.log(this._playing);\n        if(this._playing) {\n            return;\n        }\n        this._playing = true;\n        this.moveNextStatus();\n    }\n\n    getPlaying() {\n        return this._playing;\n    }\n\n    moveNextStatus() {\n\n        this._finished = 0;\n        var len = this.node.children.length;\n        var self = this;\n        for (var i = 0; i < len; i ++) {\n            var pos = this.node.children[i].position;\n\n                cc.tween(this.node.children[i])\n                    .delay(this._firstDelay)\n                    .to(this._speed, { position: cc.v3(0, pos.y-76, 0) })\n                    .call(() => {\n                        self.movingFinished();\n                    })\n                .start();\n\n        }\n\n        this._firstDelay = 0;\n    }\n\n    movingFinished() {\n\n        this._finished ++;\n        var len = this.node.children.length;\n        \n        if (this._finished < len) return ;\n        \n        for (var i = 0; i < len; i ++) {\n            var pos = this.node.children[i].position;\n            //console.log (pos);\n            if(pos.y < -10)  this.node.children[i].setPosition(cc.v3(0, len * 76 - 76, 0));\n        }\n\n        for (var i = 0; i < len; i ++) {\n            //console.log('---------');\n            //console.log (this.node.children[i].position);\n        }\n\n        this._count --;\n        if(this._count > 0) this.moveNextStatus();\n        else this.rollingFinished();\n    }\n\n    rollingFinished() {\n        var len = this.node.children.length;\n        for (var i = 0; i < len; i ++) {\n\n            var anim = this.node.children[i].getComponent(cc.Animation);\n            if  (anim != null) anim.play();\n        }\n        this._playing = false;\n    }\n\n}\n\n"]}